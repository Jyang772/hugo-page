<!doctype html>
<html lang='en-us'><head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WBN59M8Y5S"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WBN59M8Y5S');
</script>


<script type="text/javascript">
  (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
  m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
  (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

  ym(53961409, "init", {
       clickmap:true,
       trackLinks:true,
       accurateTrackBounce:true,
       webvisor:true
  });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/53961409" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<meta charset="utf-8">

  
  <link rel="stylesheet" href="/style.min.a3a4a7a8e8602aaa85b7cb3d655edde028ac80d73f2a97389e2cbcf995dd672d.css" integrity="sha256-o6SnqOhgKqqFt8s9ZV7d4CisgNc/Kpc4niy8&#43;ZXdZy0=">
  <link rel="stylesheet" href="/syntax.css" id="syntax-theme">

  <link rel="stylesheet" type="text/css" href="https://tikzjax.com/v1/fonts.css">
  <script src="https://tikzjax.com/v1/tikzjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js"></script>
  <script src="/scripts/lunr.stemmer.support.min.js"></script>
  <script src="/scripts/lunr.ru.min.js"></script>
  <script src="/scripts/lunr.multi.min.js"></script>

  
  <link rel="stylesheet" id="theme">

  <script>
    function toggleSidebar() {
      console.log("Toggling sidebar visibility")
      var sidebar = document.getElementById('sidebar')
      var wrapper = document.getElementById('wrapper')
      if (sidebar.classList.contains('sidebar-toggled') || window.getComputedStyle(sidebar).display == 'block') { 
        sidebar.classList.toggle('sidebar-hidden')
        wrapper.classList.toggle('sidebar-hidden')
      }
      sidebar.classList.add('sidebar-toggled')
      wrapper.classList.add('sidebar-toggled')
    }

    function switchTheme(theme) {
      console.log("Changing theme:", theme)
      document.getElementById('theme').href = (theme == 'dark' ? "\/dark.min.b3ae1169831434b11b48de5b3e3210547eea6b7884c295ab0030cb973ea0dc49.css" : "")
      document.getElementById('syntax-theme').href = (theme == 'dark' ? '/syntax-dark.css' : '/syntax.css')
      localStorage.setItem('theme', theme)
    }

    async function toggleSearch() {
      console.log("Toggling search")
      
      var searchDiv = document.getElementById('search')
      if (window.getComputedStyle(searchDiv).display == 'none') {
        searchDiv.style.display = 'block'
        window.scrollTo({ top: 0 });
        document.getElementById('search-bar').focus()
      } else {
        searchDiv.style.display = 'none'  
      }

      if (!index) {
        console.log("Fetching index")
        const response = await fetch('/searchindex.json')
        const pages = await response.json()
        index = lunr(function() {
          this.use(lunr.multiLanguage('en', 'ru'))
          this.field('title', {
            boost: 5
          })
          this.field('content', {
            boost: 1
          })
          pages.forEach(function(doc) {
            this.add(doc)
            articles.push(doc)
          }, this)
        })
        console.log("Ready to search")
      }
    }

    var articles = []
    var index = undefined

    function search() {
      var query = document.getElementById('search-bar').value
      var resultsDiv = document.getElementById('search-results')
      var countDiv = document.getElementById('search-count')
      
      if (query == '') {
        resultsDiv.innerHTML = ''
        countDiv.innerHTML = ''
        return
      }
      
      var results = index.search(query)

      countDiv.innerHTML = 'Found <b>' + results.length + '</b> pages'

      let resultList = ''

      for (const n in results) {
        const item = articles[results[n].ref]
        resultList += '<li><a href="' + item.path + '">' + item.title + '</a> <p>'
        const text = item.content

        const contextLimit = 80

        if (text.includes(query)) {
          const start = text.indexOf(query)
          if (start > contextLimit)
            resultList += '…'
          resultList += text.substring(start - contextLimit, start)
                      + '<b>' + query + '</b>' + text.substring(start + query.length, start + query.length + contextLimit)

        } else {
          resultList += text.substring(0, contextLimit * 2)
        }
        resultList += '…</p></li>'
      }

      resultsDiv.innerHTML = resultList
    }

    if (localStorage.getItem('theme') == 'dark') {
      switchTheme('dark')
    }

    window.addEventListener('load', function() {
      var el = document.getElementById("active-element")
      
      if (el) {
        el.scrollIntoView({block: "center"})
      }
      

    })

    window.addEventListener('scroll', function() {
      var menu = document.getElementById('menu')
      if (window.scrollY < 120) {
        
        menu.classList.remove('scrolled')
      } else {
        
        menu.classList.add('scrolled')
      }
    })

    window.addEventListener('keydown', function(e) {
      if (e.altKey) { return }
      if (document.activeElement.tagName == 'INPUT') { return }
      if (e.key == 'ArrowLeft') {
        document.getElementById('prev-article').click()
      } else if (e.key == 'ArrowRight') {
        document.getElementById('next-article').click()
      }
    })
  </script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
  onload="renderMathInElement(document.body, {
    delimiters: [
      {left: '$$', right: '$$', display: true},
      {left: '$', right: '$', display: false}
    ]
  })"></script>

  
  <title>Machine Code Analyzers - Algorithmica</title>
</head>
<body><nav id='sidebar' >
  
  
  <div class='title'>
    <a href='/'>Algorithmica</a>
    
      
        
        <span class='slash'>/</span>
        <a href='/hpc/' class='divisionAbbr'
           >
          HPC
        </a>
      
    
  </div>
  <ul>
    
      
        
          <li class='part'>Performance Engineering</li>
        
        <li class=' '><a href='/hpc/complexity/'
          
          >Complexity Models</a></li>
        
          <ol>
            
              <li ><a href='/hpc/complexity/hardware/'
                
                >Modern Hardware</a></li>
            
              <li ><a href='/hpc/complexity/languages/'
                
                >Programming Languages</a></li>
            
          </ol>
        
      
        
        <li class=' '><a href='/hpc/architecture/'
          
          >Computer Architecture</a></li>
        
          <ol>
            
              <li ><a href='/hpc/architecture/isa/'
                
                >Instruction Set Architectures</a></li>
            
              <li ><a href='/hpc/architecture/assembly/'
                
                >Assembly Language</a></li>
            
              <li ><a href='/hpc/architecture/loops/'
                
                >Loops and Conditionals</a></li>
            
              <li ><a href='/hpc/architecture/functions/'
                
                >Functions and Recursion</a></li>
            
              <li ><a href='/hpc/architecture/indirect/'
                
                >Indirect Branching</a></li>
            
              <li ><a href='/hpc/architecture/layout/'
                
                >Machine Code Layout</a></li>
            
          </ol>
        
      
        
        <li class=' '><a href='/hpc/pipelining/'
          
          >Instruction-Level Parallelism</a></li>
        
          <ol>
            
              <li ><a href='/hpc/pipelining/hazards/'
                
                >Pipeline Hazards</a></li>
            
              <li ><a href='/hpc/pipelining/branching/'
                
                >The Cost of Branching</a></li>
            
              <li ><a href='/hpc/pipelining/branchless/'
                
                >Branchless Programming</a></li>
            
              <li ><a href='/hpc/pipelining/tables/'
                
                >Instruction Tables</a></li>
            
              <li ><a href='/hpc/pipelining/throughput/'
                
                >Throughput Computing</a></li>
            
          </ol>
        
      
        
        <li class=' '><a href='/hpc/compilation/'
          
          >Compilation</a></li>
        
          <ol>
            
              <li ><a href='/hpc/compilation/stages/'
                
                >Stages of Compilation</a></li>
            
              <li ><a href='/hpc/compilation/flags/'
                
                >Flags and Targets</a></li>
            
              <li ><a href='/hpc/compilation/situational/'
                
                >Situational Optimizations</a></li>
            
              <li ><a href='/hpc/compilation/contracts/'
                
                >Contract Programming</a></li>
            
              <li ><a href='/hpc/compilation/precalc/'
                
                >Precomputation</a></li>
            
          </ol>
        
      
        
        <li class=' '><a href='/hpc/profiling/'
          
          >Profiling</a></li>
        
          <ol>
            
              <li ><a href='/hpc/profiling/instrumentation/'
                
                >Instrumentation</a></li>
            
              <li ><a href='/hpc/profiling/events/'
                
                >Statistical Profiling</a></li>
            
              <li ><a href='/hpc/profiling/simulation/'
                
                >Program Simulation</a></li>
            
              <li ><a href='/hpc/profiling/mca/'
                id='active-element'
                >Machine Code Analyzers</a></li>
            
              <li ><a href='/hpc/profiling/benchmarking/'
                
                >Benchmarking</a></li>
            
              <li ><a href='/hpc/profiling/noise/'
                
                >Getting Accurate Results</a></li>
            
          </ol>
        
      
        
        <li class=' '><a href='/hpc/arithmetic/'
          
          >Arithmetic</a></li>
        
          <ol>
            
              <li ><a href='/hpc/arithmetic/float/'
                
                >Floating-Point Numbers</a></li>
            
              <li ><a href='/hpc/arithmetic/ieee-754/'
                
                >IEEE 754 Floats</a></li>
            
              <li ><a href='/hpc/arithmetic/errors/'
                
                >Rounding Errors</a></li>
            
              <li ><a href='/hpc/arithmetic/newton/'
                
                >Newton&#39;s Method</a></li>
            
              <li ><a href='/hpc/arithmetic/rsqrt/'
                
                >Fast Inverse Square Root</a></li>
            
              <li ><a href='/hpc/arithmetic/integer/'
                
                >Integer Numbers</a></li>
            
              <li ><a href='/hpc/arithmetic/division/'
                
                >Integer Division</a></li>
            
          </ol>
        
      
        
        <li class=' '><a href='/hpc/number-theory/'
          
          >Number Theory</a></li>
        
          <ol>
            
              <li ><a href='/hpc/number-theory/modular/'
                
                >Modular Arithmetic</a></li>
            
              <li ><a href='/hpc/number-theory/exponentiation/'
                
                >Binary Exponentiation</a></li>
            
              <li ><a href='/hpc/number-theory/euclid-extended/'
                
                >Extended Euclidean Algorithm</a></li>
            
              <li ><a href='/hpc/number-theory/montgomery/'
                
                >Montgomery Multiplication</a></li>
            
          </ol>
        
      
        
        <li class=' '><a href='/hpc/external-memory/'
          
          >External Memory</a></li>
        
          <ol>
            
              <li ><a href='/hpc/external-memory/hierarchy/'
                
                >Memory Hierarchy</a></li>
            
              <li ><a href='/hpc/external-memory/virtual/'
                
                >Virtual Memory</a></li>
            
              <li ><a href='/hpc/external-memory/model/'
                
                >External Memory Model</a></li>
            
              <li ><a href='/hpc/external-memory/sorting/'
                
                >External Sorting</a></li>
            
              <li ><a href='/hpc/external-memory/list-ranking/'
                
                >List Ranking</a></li>
            
              <li ><a href='/hpc/external-memory/policies/'
                
                >Eviction Policies</a></li>
            
              <li ><a href='/hpc/external-memory/oblivious/'
                
                >Cache-Oblivious Algorithms</a></li>
            
              <li ><a href='/hpc/external-memory/locality/'
                
                >Spatial and Temporal Locality</a></li>
            
          </ol>
        
      
        
        <li class=' '><a href='/hpc/cpu-cache/'
          
          >RAM &amp; CPU Caches</a></li>
        
          <ol>
            
              <li ><a href='/hpc/cpu-cache/bandwidth/'
                
                >Memory Bandwidth</a></li>
            
              <li ><a href='/hpc/cpu-cache/latency/'
                
                >Memory Latency</a></li>
            
              <li ><a href='/hpc/cpu-cache/cache-lines/'
                
                >Cache Lines</a></li>
            
              <li ><a href='/hpc/cpu-cache/sharing/'
                
                >Memory Sharing</a></li>
            
              <li ><a href='/hpc/cpu-cache/mlp/'
                
                >Memory-Level Parallelism</a></li>
            
              <li ><a href='/hpc/cpu-cache/prefetching/'
                
                >Prefetching</a></li>
            
              <li ><a href='/hpc/cpu-cache/alignment/'
                
                >Alignment and Packing</a></li>
            
              <li ><a href='/hpc/cpu-cache/pointers/'
                
                >Pointer Alternatives</a></li>
            
              <li ><a href='/hpc/cpu-cache/associativity/'
                
                >Cache Associativity</a></li>
            
              <li ><a href='/hpc/cpu-cache/paging/'
                
                >Memory Paging</a></li>
            
              <li ><a href='/hpc/cpu-cache/aos-soa/'
                
                >AoS and SoA</a></li>
            
          </ol>
        
      
        
        <li class=' '><a href='/hpc/simd/'
          
          >SIMD Parallelism</a></li>
        
          <ol>
            
              <li ><a href='/hpc/simd/intrinsics/'
                
                >Intrinsics and Vector Types</a></li>
            
              <li ><a href='/hpc/simd/moving/'
                
                >Moving Data</a></li>
            
              <li ><a href='/hpc/simd/reduction/'
                
                >Reductions</a></li>
            
              <li ><a href='/hpc/simd/masking/'
                
                >Masking and Blending</a></li>
            
              <li ><a href='/hpc/simd/shuffling/'
                
                >In-Register Shuffles</a></li>
            
              <li ><a href='/hpc/simd/auto-vectorization/'
                
                >Auto-Vectorization and SPMD</a></li>
            
          </ol>
        
      
        
        <li class=' '><a href='/hpc/algorithms/'
          
          >Algorithms Case Studies</a></li>
        
          <ol>
            
              <li ><a href='/hpc/algorithms/gcd/'
                
                >Binary GCD</a></li>
            
              <li ><a href='/hpc/algorithms/factorization/'
                
                >Integer Factorization</a></li>
            
              <li ><a href='/hpc/algorithms/argmin/'
                
                >Argmin with SIMD</a></li>
            
              <li ><a href='/hpc/algorithms/prefix/'
                
                >Prefix Sum with SIMD</a></li>
            
              <li ><a href='/hpc/algorithms/matmul/'
                
                >Matrix Multiplication</a></li>
            
          </ol>
        
      
        
        <li class=' '><a href='/hpc/data-structures/'
          
          >Data Structures Case Studies</a></li>
        
          <ol>
            
              <li ><a href='/hpc/data-structures/binary-search/'
                
                >Binary Search</a></li>
            
              <li ><a href='/hpc/data-structures/s-tree/'
                
                >Static B-Trees</a></li>
            
              <li ><a href='/hpc/data-structures/b-tree/'
                
                >Search Trees</a></li>
            
              <li ><a href='/hpc/data-structures/segment-trees/'
                
                >Segment Trees</a></li>
            
          </ol>
        
      
    
  </ul>
</nav>
<div id='wrapper' ><menu id='menu'>
  
  
  <div class='left'>
    <a>
      <img src='/icons/bars-solid.svg'
           onclick='toggleSidebar()'
           title='open table of contents'>
    </a>
    <a>
      <img src='/icons/adjust-solid.svg'
           style='position: relative; top: -1px'
           onclick='switchTheme(localStorage.getItem("theme") == "dark" ? "light" : "dark")'
           title='dark theme'>
    </a>
    <a>
      <img src='/icons/search-solid.svg'
           onclick='toggleSearch()'
           title='search'>
    </a>
  </div>
  <div class='title'>Machine Code Analyzers</div>
  <div class='right'>
    <a onClick='window.print()'>
      <img src='/icons/print-solid.svg' title='print'>
    </a>
    <a href='https://prose.io/#algorithmica-org/algorithmica/edit/master//hpc%2fprofiling%2fmca.md'>
      <img src='/icons/edit-solid.svg'
           title='edit'
           style='width: 18px; position: relative; right: -2px; top: -1px'>
    </a>
    <a href='https://github.com/algorithmica-org/algorithmica/blob/master//hpc/profiling/mca.md' class='github-main'>
      <img src='/icons/github-brands.svg' title='view on github'>
    </a>
  </div>
</menu>
<main>
        <div id="search">
    <input id="search-bar" type="search" placeholder='Search this book…' oninput="search()">
    <div id="search-count"></div>
    <div id="search-results">
    </div>
</div>
<header>
  
  <h1>Machine Code Analyzers</h1>
  
    <div class='info'></div>
  
</header>
<article>
  


  
    
    
      
        <p>A <em>machine code analyzer</em> is a program that takes a small snippet of assembly code and <a href="../simulation">simulates</a> its execution on a particular microarchitecture using information available to compilers, and outputs the latency and throughput of the whole block, as well as cycle-perfect utilization of various resources within the CPU.</p>
<span class='anchor' id="using-llvm-mca"></span>
<h3><a class="anchor-link" href="https://en.algorithmica.org/hpc/profiling/mca/#using-llvm-mca">#</a>Using <code>llvm-mca</code></h3><p>There are many different machine code analyzers, but I personally prefer <code>llvm-mca</code>, which you can probably install via a package manager together with <code>clang</code>. You can also access it through a web-based tool called <a href="https://uica.uops.info">UICA</a> or in the <a href="https://godbolt.org/">Compiler Explorer</a> by selecting &ldquo;Analysis&rdquo; as the language.</p>
<p>What <code>llvm-mca</code> does is it runs a set number of iterations of a given assembly snippet and computes statistics about the resource usage of each instruction, which is useful for finding out where the bottleneck is.</p>
<p>We will consider the array sum as our simple example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nl">loop:</span>
</span></span><span class="line"><span class="cl">    <span class="nf">addl</span> <span class="p">(</span><span class="nv">%rax</span><span class="p">),</span> <span class="nv">%edx</span>
</span></span><span class="line"><span class="cl">    <span class="nf">addq</span> <span class="no">$4</span><span class="p">,</span> <span class="nv">%rax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">cmpq</span> <span class="nv">%rcx</span><span class="p">,</span> <span class="nv">%rax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">jne</span>	 <span class="no">loop</span>
</span></span></code></pre></div><p>Here is its analysis with <code>llvm-mca</code> for the Skylake microarchitecture:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Iterations</span><span class="p">:</span><span class="w">        </span><span class="m">100</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Instructions</span><span class="p">:</span><span class="w">      </span><span class="m">400</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Total Cycles</span><span class="p">:</span><span class="w">      </span><span class="m">108</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Total uOps</span><span class="p">:</span><span class="w">        </span><span class="m">500</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Dispatch Width</span><span class="p">:</span><span class="w">    </span><span class="m">6</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">uOps Per Cycle</span><span class="p">:</span><span class="w">    </span><span class="m">4.63</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">IPC</span><span class="p">:</span><span class="w">               </span><span class="m">3.70</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Block RThroughput</span><span class="p">:</span><span class="w"> </span><span class="m">0.8</span><span class="w">
</span></span></span></code></pre></div><p>First, it outputs general information about the loop and the hardware:</p>
<ul>
<li>It &ldquo;ran&rdquo; the loop 100 times, executing 400 instructions in total in 108 cycles, which is the same as executing $\frac{400}{108} \approx 3.7$ <a href="/hpc/complexity/hardware">instructions per cycle</a> on average (IPC).</li>
<li>The CPU is theoretically capable of executing up to 6 instructions per cycle (<a href="/hpc/architecture/layout">dispatch width</a>).</li>
<li>Each cycle in theory can be executed in 0.8 cycles on average (<a href="/hpc/pipelining/tables">block reciprocal throughput</a>).</li>
<li>The &ldquo;uOps&rdquo; here are the micro-operations that the CPU splits each instruction into (e.g., fused load-add is composed of two uOps).</li>
</ul>
<p>Then it proceeds to give information about each individual instruction:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Instruction Info</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">[1]</span><span class="p">:</span><span class="w"> </span><span class="l">uOps</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">[2]</span><span class="p">:</span><span class="w"> </span><span class="l">Latency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">[3]</span><span class="p">:</span><span class="w"> </span><span class="l">RThroughput</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">[4]</span><span class="p">:</span><span class="w"> </span><span class="l">MayLoad</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">[5]</span><span class="p">:</span><span class="w"> </span><span class="l">MayStore</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">[6]</span><span class="p">:</span><span class="w"> </span><span class="l">HasSideEffects (U)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">[1]    [2]    [3]    [4]    [5]    [6]    Instructions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="m">2</span><span class="w">      </span><span class="m">6</span><span class="w">     </span><span class="m">0.50</span><span class="w">    </span>*<span class="w">                   </span><span class="l">addl	(%rax), %edx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="m">1</span><span class="w">      </span><span class="m">1</span><span class="w">     </span><span class="m">0.25</span><span class="w">                        </span><span class="l">addq	$4, %rax</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="m">1</span><span class="w">      </span><span class="m">1</span><span class="w">     </span><span class="m">0.25</span><span class="w">                        </span><span class="l">cmpq	%rcx, %rax</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="m">1</span><span class="w">      </span><span class="m">1</span><span class="w">     </span><span class="m">0.50</span><span class="w">                        </span><span class="l">jne	-11</span><span class="w">
</span></span></span></code></pre></div><p>There is nothing there that there isn&rsquo;t in the <a href="/hpc/pipelining/tables">instruction tables</a>:</p>
<ul>
<li>how many uOps each instruction is split into;</li>
<li>how many cycles each instruction takes to complete (latency);</li>
<li>how many cycles each instruction takes to complete in the amortized sense (reciprocal throughput), considering that several copies of it can be executed simultaneously.</li>
</ul>
<p>Then it outputs probably the most important part — which instructions are executing when and where:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Resource pressure by instruction</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">[0]    [1]    [2]    [3]    [4]    [5]    [6]    [7]    [8]    [9]    Instructions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="w">     </span>- <span class="w">    </span><span class="m">0.01</span><span class="w">   </span><span class="m">0.98</span><span class="w">   </span><span class="m">0.50</span><span class="w">   </span><span class="m">0.50</span><span class="w">    </span>- <span class="w">     </span>- <span class="w">    </span><span class="m">0.01</span><span class="w">    </span>- <span class="w">    </span><span class="l">addl (%rax), %edx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="w">     </span>- <span class="w">     </span>- <span class="w">     </span>- <span class="w">     </span>- <span class="w">     </span>- <span class="w">     </span>- <span class="w">    </span><span class="m">0.01</span><span class="w">   </span><span class="m">0.99</span><span class="w">    </span>- <span class="w">    </span><span class="l">addq $4, %rax</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="w">     </span>- <span class="w">     </span>- <span class="w">    </span><span class="m">0.01</span><span class="w">    </span>- <span class="w">     </span>- <span class="w">     </span>- <span class="w">    </span><span class="m">0.99</span><span class="w">    </span>- <span class="w">     </span>- <span class="w">    </span><span class="l">cmpq %rcx, %rax</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="w">     </span>- <span class="w">    </span><span class="m">0.99</span><span class="w">    </span>- <span class="w">     </span>- <span class="w">     </span>- <span class="w">     </span>- <span class="w">     </span>- <span class="w">    </span><span class="m">0.01</span><span class="w">    </span>- <span class="w">    </span><span class="l">jne  -11</span><span class="w">
</span></span></span></code></pre></div><p>As the contention for execution ports causes <a href="/hpc/pipelining/hazards">structural hazards</a>, ports often become the bottleneck for throughput-oriented loops, and this chart helps diagnose why. It does not give you a cycle-perfect Gantt chart of something like that, but it gives you the aggregate statistics of the execution ports used for each instruction, which lets you find which one is overloaded.</p>
<!--

A CPU is a very complicated thing, but in essence, there are several "ports" that specialize on particular kinds of instructions. These ports often become the bottleneck, and the chart above helps in diagnosing why.

We are not ready to discuss how this works yet, but will talk about it in detail in the last chapter.

-->

      
    
  



        </article>
        <div class='nextprev'>
  
    
      
      

      
      
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      

      
        <div class='left'>
        
          <a href='https://en.algorithmica.org/hpc/profiling/simulation/' id='prev-article'>← Program Simulation</a>
        
        </div>
        <div class='right'>
        
          <a href='https://en.algorithmica.org/hpc/profiling/benchmarking/' id='next-article'>Benchmarking →</a>
        
        </div>
      
    
  
</div>

      </main>
      <footer>
  Copyright 2021–2022 Sergey Slotin
  <br>
   
</footer>

    </div>
  </body>
</html>
